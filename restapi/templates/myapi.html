{% extends "index.html" %}

{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/myapi.css' %}">

<div class="api-management">
    <div>
        <label for="apiKeyDisplay">API KEY : </label>
        <input type="text" id="apiKeyDisplay" readonly onclick="copyApiKey()">
        <button onclick="regenerateApiKey()">Regenerate Key</button>
    </div>
    <div>
        <h2>API document</h2>
        <ul>
            <li><a href="{% url 'api_weather' %}">Weather API</a></li>
            <li><a href="/process_video">Process Video API</a></li>
        </ul>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        showApiKey();
    });

    function regenerateApiKey() {
        fetch('{% url "refresh_api_key" %}')
            .then(response => response.json())
            .then(data => {
                document.getElementById('apiKeyDisplay').value = data.new_key;
            });
    }

    function showApiKey() {
        fetch('{% url "get_api_key" %}')
            .then(response => response.json())
            .then(data => {
                document.getElementById('apiKeyDisplay').value = data.key;
            });
    }

    function copyApiKey() {
        const apiKeyInput = document.getElementById('apiKeyDisplay');
        apiKeyInput.select();
        document.execCommand('copy');

        // 툴팁 생성 및 위치 설정
        let tooltip = document.createElement('div');
        tooltip.className = 'copy-tooltip';
        tooltip.textContent = 'Copied!';
        document.body.appendChild(tooltip);

        // 마우스 이벤트에 따라 툴팁 위치 업데이트
        function moveTooltip(e) {
            tooltip.style.left = e.pageX + 10 + 'px';
            tooltip.style.top = e.pageY + 10 + 'px';
            tooltip.style.visibility = 'visible';
            tooltip.style.opacity = '1';
        }

        document.addEventListener('mousemove', moveTooltip);

        // 일정 시간 후 툴팁 제거
        setTimeout(function() {
            tooltip.style.opacity = '0';
            document.removeEventListener('mousemove', moveTooltip);
            setTimeout(() => document.body.removeChild(tooltip), 500);
        }, 2000);
    }
</script>
{% endblock %}
